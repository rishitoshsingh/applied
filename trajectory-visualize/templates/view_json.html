<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>LLM Trajectory Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css" />
    <style>
        .markdown-body {
            background-color: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .meta-label {
            font-weight: bold;
        }

        .msg-role {
            font-weight: bold;
        }

        .msg-block {
            margin-bottom: 1em;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container py-4">
        <h2 class="mb-4">LLM Trajectory Viewer</h2>
        <div class="mb-3"><a href="/">&larr; Back</a> <span class="text-muted small ms-2">Viewing: {{ file_path
                }}</span></div>
        <div class="accordion" id="taskAccordion">
            {% for task in data %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-{{ loop.index }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapse-{{ loop.index }}" aria-expanded="false"
                        aria-controls="collapse-{{ loop.index }}">
                        Task ID: {{ task.task_id }}
                        {% if task.reward is defined %}
                        <span class="ms-auto text-muted small">Reward: {{ task.reward }}</span>
                        {% endif %}
                    </button>
                </h2>
                <div id="collapse-{{ loop.index }}" class="accordion-collapse collapse"
                    aria-labelledby="heading-{{ loop.index }}" data-bs-parent="#taskAccordion">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h5>Task Details</h5>
                                <div class="markdown-body">
                                    {% if task.task_details %}
                                    <div><span class="meta-label">User ID:</span> {{ task.task_details.user_id if
                                        task.task_details.user_id else 'N/A' }}</div>
                                    <div><span class="meta-label">Instruction:</span><br>
                                        <pre
                                            style="white-space:pre-wrap; background:transparent; border:none; padding:0; margin:0;">{{ task.task_details.instruction if task.task_details.instruction else 'N/A' }}</pre>
                                    </div>
                                    <div><span class="meta-label">Actions:</span>
                                        <pre
                                            style="white-space:pre-wrap; background:transparent; border:none; padding:0; margin:0;">{{ task.task_details.actions | tojson(indent=2) if task.task_details.actions else 'N/A' }}</pre>
                                    </div>
                                    <div><span class="meta-label">Outputs:</span>
                                        <pre
                                            style="white-space:pre-wrap; background:transparent; border:none; padding:0; margin:0;">{{ task.task_details.outputs | tojson(indent=2) if task.task_details.outputs else 'N/A' }}</pre>
                                    </div>
                                    {% else %}
                                    <div>No task details available.</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h5>Reward Details</h5>
                                <div class="markdown-body">
                                    {% if task.reward_details %}
                                    <pre
                                        style="white-space:pre-wrap; background:transparent; border:none; padding:0; margin:0;">{{ task.reward_details | tojson(indent=2) }}</pre>
                                    {% else %}
                                    <div>No reward details available.</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5>Conversation</h5>
                            <div class="markdown-body">
                                {{ task.rendered_markdown|safe }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>